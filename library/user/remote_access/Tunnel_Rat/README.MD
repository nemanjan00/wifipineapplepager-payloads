<div align="center">
  
# üìü Tunnel Rat üêÄ‚†Ä‚†Ä

‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°§‚£Ñ‚¢Ä‚£¥‚†Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚†¥‚°¶‚†§‚†§‚†§‚£Ñ‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚†Ä‚†ì‚£å‚£è‚†å‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚¢∂‚£ã‚£Ñ‚£Ä‚°Ä‚†Ä‚†Ñ‚†Ä‚†Ä‚†Ä‚†â‚†¢‚£Ñ‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢£‚°Ä‚¢∞‚£∑‚£Ç‚£Ä‚£Ä‚£Ä‚°¥‚†ì‚†â‚†â‚†Ä‚†â‚†ç‚†ª‚¢∂‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†£‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†ô‚†í‚†í‚†§‚°Ä‚£†‚°∑‚†õ‚†â‚¢Å‚°Ä‚°Ä‚£Ä‚£Ä‚°§‚†§‚¢§‚°Ä‚†Ä‚†Ä‚†Ä‚†â‚†õ‚†¢‚†Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†±‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚†û‚†Å‚†Ä‚£Ä‚£≠‚°Å‚†Ä‚†Ä‚†Ä‚†è‚¢Å‚£Ä‚£Ä‚†ô‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚¢∞‚†ã‚£Ä‚£Ä‚†Ä‚†Ä‚†ô‚†õ‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚£É‚°¥‚†ã‚†Å‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚†ì‚†¶‚£ÄT‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚¢Ä‚£∏‚£ü‚£Ñ‚†ò‚£Ø‚†ç‚†ç‚£â‚†í‚†Ç‚†§‚°Ñ‚†Ä‚£Ö‚†Ä‚£Ä‚°¥‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£æ‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚£ß‚£Ä‚°Ä‚†ô‚¢¶U‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†ê‚¢Å‚†é‚†à‚†â‚†ì‚†í‚†ª‚¢¶‚°Ä‚†â‚†í‚¢Ñ‚°Ä‚†Ä‚†Ä‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£∏‚£á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚££‚†à‚†ô‚†≥‚£Ñ‚†ô‚¢¶N‚†Ä‚†Ä‚†Ä‚†Ä
‚¢Ä‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚£Ñ‚£Ñ‚†Ä‚¢Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£∞‚£ü‚£Å‚†Ä‚†Ä‚£Ä‚£Ñ‚°≤‚¢ø‚°Ä‚†Ä‚†Ä‚†à‚†≥‚£Ñ‚†π‚£ÑN‚†Ä‚†Ä‚†Ä
‚°å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚£∂‚£è‚†â‚†ô‚°å‚¢∑‚£º‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£§‚°∂‚†ã‚†â‚†â‚†â‚¢â‚°Ω‚†â‚†Ä‚¢∏‚°±‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚°Ü‚¢π‚°ÑE‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢ª‚£Ø‚°µ‚¢∂‚£¥‚¢ø‚†õ‚†ã‚†â‚£∫‚°∂‚£¶‚£§‚£ô‚°ø‚†ø‚†ã‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚¢º‚°ü‚£ª‚£É‚£¥‚¢∞‚†á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢ª‚†Ä‚£∑ L‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†Å‚†ò‚¢Ä‚°¥‚£ø‚£ø‚¢†‚¢Ä‚°æ‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚†ª‚†ã‚†≥‚†è‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚†Ä‚£ø‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚†ª‚£ß‚¢ß‚°º‚£§‚†á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°Ñ‚£ø R‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Å‚†à‚†Ä‚†à‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢ß‚¢ª‚°ÑA‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ª‚£ø‚°ÑT

[github.com/OSINTI4L](https://github.com/OSINTI4L)

Built on WiFi Pineapple Pager firmware `v1.0.6`

### [What is Tunnel Rat?](#what-is-tunnel-jump) | [Payload Workflow](#payload-jump) | [Dependencies and Configuration](#dependencies-jump)

</div>

<a id="what-is-tunnel-jump"></a>
## üêÅ What is Tunnel Rat?
Tunnel Rat is a [Hak5 WiFi Pineapple Pager](https://shop.hak5.org/products/pager) payload designed to allow an attacker remote access to a target `wpa2-psk` network via reverse `SSH` tunneling from the pager to a virtual private server (VPS) being used as a Command and Control (C2) server. This gives the attacker a root shell on the pager. The payload assumes that the target network credentials are *not* known and uses methods to allow target network handshake files to be grabbed by the attacker to crack and then pass the cracked password back to the pager, allowing the pager on the target network. The idea behind development of the payload is to allow a pager to be implanted in a target environment and left to be accessed remotely for network exploitation.

<a id="payload-jump"></a>
## üîÑ Payload Workflow
**1)** The attacker is prompted for the target `wpa2-psk` network SSID.

**2)** The payload then idles for a 60 second period allowing Recon to scan the wireless airspace.

**3)** If the target network is found, the pager channel locks to the target network access point (AP) to optomize the radio for handshake capture.

**4)** The pager then checks to see if a handshake has already been captured, else performs a deauthentication attack against the target network, waits 60 sconds, and re-checks. If a handshake is not present the attack loops until a handshake is captured.
> Note: The payload only checks to see if .22000 ("Hashcat format") handshakes have been captured.

**5)** Once a handshake has been captured the radio channel lock is lifted returning the radio to its default scanning environment.

**6).** When the pager captures a handshake it spawns the "management access point" (the AP used to connect to the pager wirelessly via the web UI at `http://172.16.52.1:1471/`). This is done for two reasons:

  - To allow the attacker to retrieve the target network handshake file (which has been re-named to be easily identifiable) so that they may crack it.
      
  - When the attacker has successfully cracked the handshake the portal prompts the attacker to enter the cracked password to be used by the pager to get onto the target network.

<img width="400" height="282" alt="pager" src="https://github.com/user-attachments/assets/acdf5ed8-40e4-43f6-9169-9c78b5f07bf3" />
  
**This means once the pager is implanted the attacker never requires physical access to the pager to interact with it, it is accessed covertly via the management AP.**

**7)** Once the attacker has entered the target network password the management portal is shutdown to obfuscate its presence.

**8)** The pager then attempts to get on the target network.

**9)** Once connected to the target network the pager sends a `ping` to discord.com to check for internet availability.

**10)** If `ping` is successful the pager will grab the public IP address of the network and send it to an attacker defined Discord webhook. This allows the attacker to be notified when the pager is online and also provides the IP address of the target network.

<img width="772" height="49" alt="hook1" src="https://github.com/user-attachments/assets/1deec382-3711-4aea-ab99-97aaeacf0170" />

**11)** The pager then sends a `ping` request to the VPS C2 server to ensure it's online. If online, an additional status update is sent to the Discord webhook.

<img width="595" height="49" alt="hook2" src="https://github.com/user-attachments/assets/d8faca0a-c7b9-4f54-b961-d5352d51d29e" />

**12)** The pager then attempts to establish a reverse `SSH` tunnel to the VPS C2 server.

**13)** If the tunnel successfully establishes, the pager notifies the attacker via the Discord webhook that the tunnel is online.
  
<img width="918" height="48" alt="hook3" src="https://github.com/user-attachments/assets/2cae2b8b-37fc-488a-81b0-ed7d6c0dfe08" />

**14)** A pager root shell is then available inside of the VPS C2 at: `ssh -p 2222 root@127.0.0.1`
  
**The attacker now has full remote access to the pager allowing further exploitation of the target network.**

<img width="450" height="465" alt="kali" src="https://github.com/user-attachments/assets/00a2e1da-fb47-471e-b4e3-04e447bb9a93" />

<a id="dependencies-jump"></a>
## üõ†Ô∏è Dependencies and Configuration
### Virtual Private Server (VPS) Command and Control (C2)
  
  - A VPS is required to host as the attacker C2 platform. During payload development a [Linode Kali Linux VPS](https://www.linode.com/docs/marketplace-docs/guides/kali-linux/) was used as the C2 platform.
      - To ensure tunneling is properly configured the following changes must be made in the `/etc/ssh/sshd_config` file of the VPS C2:
             `AllowTcpForwarding yes`
             `PasswordAuthentication yes`
             `GatewayPorts no`
      - Restart the service after making changes: `systemctl restart ssh`
      - Define the VPS C2 IP address to the `payload.sh` file:
             `Line 11: VPSIP="X.X.X.X-Enter-VPS-C2-IP-Here"`
      - Define the VPS C2 `SSH` password to the `payload.sh` file:
             `Line 12: SSHPW="Enter-VPS-C2-SSH-Password-Here"`

### Discord webhook
  - A [Discord webhook](https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks) is required to send payload status updates to the attacker.
      - Define the Discord webhook in the `payload.sh` file:
             `Line 10: DISCORD_WEBHOOK="https://discord.com/api/webhooks/Enter/Discord/Webhook/Here"` 

### `sshpass`
  - To simplify/streamline the `SSH` connection (as it's ran in the background on the pager) a password is used for `SSH` authentication to the VPS C2 instead of a keypair. Because of this, `sshpass` must be installed on the pager via:
      `opkg update && opkg install -d mmc sshpass`

### Management AP
  - The management access point is used as a method to grab handshake files and then pass the cracked network password back to the pager. The SSID and password of the management ap must be defined in the `payload.sh` file:
    - Define the SSID:
      `Line 8: MAPSSID="Name-Management-Portal-SSID-Here"`
    - Define the password:
      `Line 9: MAPPASS="Enter-Management-Portal-Password-Here"`

### PineAP
  - Ensure PineAP (in pager settings) is set to collect handshakes: `PineAP > "Collect Handshakes" > enable`

<div align="center">
  
# ü™§  üêÅ

</div>
